This is version 2 fof branch master.